{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./ts/main/rule/RelatiRouteRule.ts","webpack:///./ts/view/Page.ts","webpack:///./ts/main/rule/PlacementRule.ts","webpack:///./ts/core/SVGProcess.ts","webpack:///./ts/view/MessageBox.ts","webpack:///./ts/main/RelatiGame.ts","webpack:///./ts/core/GridBoard.ts","webpack:///./ts/main/RelatiBoard.ts","webpack:///./ts/main/RelatiPlayer.ts","webpack:///./ts/view/RelatiBoardView.ts","webpack:///./ts/view/RelatiEffectView.ts","webpack:///./ts/main/skill/Placement.ts","webpack:///./ts/main/skill/Relati.ts","webpack:///./script-launcher.ts","webpack:///./ts/page/MainPage.ts","webpack:///./ts/page/GamePage.ts","webpack:///./ts/main/RelatiDefs.ts","webpack:///./ts/main/rule/WinnerDecision.ts","webpack:///./ts/page/HelpPage.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","GridBoard_1","DRCT_F","GRID_DRCT","DRCT_B","DRCT_R","DRCT_L","DRCT_FR","DRCT_FL","DRCT_BR","DRCT_BL","DRCT_2F","DRCT_2B","DRCT_2R","DRCT_2L","DRCT_2FR","DRCT_2FL","DRCT_2BR","DRCT_2BL","DRCT_FFR","DRCT_FFL","DRCT_BBR","DRCT_BBL","DRCT_FRR","DRCT_FLL","DRCT_BRR","DRCT_BLL","NORMAL_ROUTES","REMOTE_NORMAL_ROUTES","REMOTE_STABLE_ROUTES","BY_NORMAL_RELATI","BY_COMMON_RELATI","RelatiRouteRule","allow","grid","symbol","statusList","routeType","targetGrid","getGrid","middleGrid1","middleGrid2","is","isSpace","middleGrid","trace","routes","push","type","grids","Page","switchToPage","activePage","document","getElementsByClassName","classList","remove","querySelector","location","hash","add","switchTo","pageName","window","addEventListener","RelatiRouteRule_1","placementStatus","PlacementRule","game","_i","_a","board","length","SVGNS","updateSVG","element","attribute","name_1","setAttribute","createSVG","tagName","createElementNS","appendSVGChild","childElements","childElements_1","childElement","appendChild","removeSVGChild","elementCount","childNodes","removeChild","MessageBox","callback","hide","view","className","isShow","response","result","getElementById","messageContent","acceptButton","rejectButton","verifyButton","show","message","innerText","style","display","event","RelatiDefs_1","WinnerDecision_1","RelatiGame","players","roleInitEffects","roleActions","rolePassEffects","this","turn","history","start","gameResult","GAME_RESULT_NONE","onstart","selectedGrid","gridSelect","_g","sent","onturnstart","_b","do","actionValid","_d","_c","_f","_e","WinnerDecision","state","onturnend","onend","restart","lost","AllRelatiStatus","_this","Promise","select","selectGrid","ongridselect","Grid","x","y","height","drct","f","b","GridBoard","width","RelatiGrid","_super","status","__extends","statusName","matchType","statusNameList","statusNameList_1","status_1","statusNameList_2","status_2","gain","statusNameList_3","status_3","statusNameList_4","status_4","RelatiBoard","RelatiPlayer","points","params","SVGProcess_1","RelatiBoardView","container","context","gridViews","routesLayer","dotsLayer","linesLayer","gridsLayer","lineAttr","line","appendGridLine","layers","gridView","RelatiGridView","feature","resize","transform","Math","min","clientWidth","clientHeight","update","stroke","stroke-width","__assign","symbolAttr","fill","srtX","srtY","endX","endY","color","SYMBOL_COLOR","","O","X","dotAttr","cx","cy","createDot","createHintEffect","grids_1","class","createLine","source","traces","traces_1","path","createRelatiLine","setTimeout","traces_2","reverse","createRelatiEffect","grids_2","grids_3","PlacementRule_1","Placement","nowPlayer","restoreStatus","restore","RestoreRepeater","DestoryRepeater","Page_1","MessageBox_1","toGamePageButton","toHelpPageButton","RelatiGame_1","RelatiBoard_1","RelatiPlayer_1","RelatiBoardView_1","RelatiEffectView_1","Placement_1","Relati_1","boardView","floor","offsetX","offsetY","messageIcon","prevPlayerSymbol","__awaiter","RelatiStatusList","RelatiSymbolList","GAME_RESULT_OWIN","GAME_RESULT_XWIN","GAME_RESULT_DRAW","playerOPlaceableGrids","playerXPlaceableGrids","playerOHasPlaceableGrid","undefined","playerXHasPlaceableGrid","toMainPageButton","helpMessaageView","stepHint","indexOf","stepGrid","stepMessage","innerHTML","childNode","opacity","0","1","3","5","7","9","11","13","15","17","19","21","23","25","27","29","31","33","35","37","39","41","43","45","47","49","2","4","6","8","10","12","20","22","24","26","28","30","32","34","36","38","40","42","44","46","48","50"],"mappings":"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","file":"script.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n","import { GRID_DRCT } from \"../../core/GridBoard\";\nimport { RelatiGrid } from \"../RelatiBoard\";\nimport { RelatiStatus, RelatiSymbol, RelatiRule, RelatiRouteType } from \"../RelatiDefs\";\n\nlet {\n    DRCT_F, DRCT_B, DRCT_R, DRCT_L,\n    DRCT_FR, DRCT_FL, DRCT_BR, DRCT_BL,\n    DRCT_2F, DRCT_2B, DRCT_2R, DRCT_2L,\n    DRCT_2FR, DRCT_2FL, DRCT_2BR, DRCT_2BL,\n    DRCT_FFR, DRCT_FFL, DRCT_BBR, DRCT_BBL,\n    DRCT_FRR, DRCT_FLL, DRCT_BRR, DRCT_BLL\n} = GRID_DRCT;\n\n/** 一般Relati路徑 */\nconst NORMAL_ROUTES = [\n    DRCT_F, DRCT_B, DRCT_R, DRCT_L,\n    DRCT_FR, DRCT_FL, DRCT_BR, DRCT_BL\n];\n\n/** 遠程Relati路徑 */\nconst REMOTE_NORMAL_ROUTES = [\n    [DRCT_2F, DRCT_F],\n    [DRCT_2B, DRCT_B],\n    [DRCT_2R, DRCT_R],\n    [DRCT_2L, DRCT_L],\n    [DRCT_2FR, DRCT_FR],\n    [DRCT_2FL, DRCT_FL],\n    [DRCT_2BR, DRCT_BR],\n    [DRCT_2BL, DRCT_BL]\n];\n\n/** 遠程穩定Relati路徑 */\nconst REMOTE_STABLE_ROUTES = [\n    [DRCT_FFR, DRCT_2F, DRCT_F],\n    [DRCT_FFR, DRCT_FR, DRCT_F],\n    [DRCT_FFR, DRCT_FR, DRCT_R],\n    [DRCT_FFL, DRCT_2F, DRCT_F],\n    [DRCT_FFL, DRCT_FL, DRCT_F],\n    [DRCT_FFL, DRCT_FL, DRCT_L],\n    [DRCT_BBR, DRCT_2B, DRCT_B],\n    [DRCT_BBR, DRCT_BR, DRCT_B],\n    [DRCT_BBR, DRCT_BR, DRCT_R],\n    [DRCT_BBL, DRCT_2B, DRCT_B],\n    [DRCT_BBL, DRCT_BL, DRCT_B],\n    [DRCT_BBL, DRCT_BL, DRCT_L],\n    [DRCT_FRR, DRCT_FR, DRCT_F],\n    [DRCT_FRR, DRCT_2R, DRCT_R],\n    [DRCT_FRR, DRCT_FR, DRCT_R],\n    [DRCT_FLL, DRCT_FL, DRCT_F],\n    [DRCT_FLL, DRCT_2L, DRCT_L],\n    [DRCT_FLL, DRCT_FL, DRCT_L],\n    [DRCT_BRR, DRCT_BR, DRCT_B],\n    [DRCT_BRR, DRCT_2R, DRCT_R],\n    [DRCT_BRR, DRCT_BR, DRCT_R],\n    [DRCT_BLL, DRCT_BL, DRCT_B],\n    [DRCT_BLL, DRCT_2L, DRCT_L],\n    [DRCT_BLL, DRCT_BL, DRCT_L]\n];\n\n/** Relati路徑 */\nexport interface RelatiRoute {\n    type: string,\n    grids: RelatiGrid[]\n}\n\n/** 使用一般Relati路徑類型 */\nexport const BY_NORMAL_RELATI: RelatiRouteType = 0;\n\n/** 使用通用Relati路徑類型 */\nexport const BY_COMMON_RELATI: RelatiRouteType = 1;\n\n/** 連結路徑規範 */\ninterface RelatiRouteRule extends RelatiRule {\n    /** 判斷是否符合連結路徑規範 */\n    allow(\n        grid: RelatiGrid,\n        symbol: RelatiSymbol,\n        statusList: RelatiStatus[],\n        routeType: RelatiRouteType\n    ): boolean;\n\n    /** 取得符合連結路徑規範的路徑 */\n    trace(\n        grid: RelatiGrid,\n        symbol: RelatiSymbol,\n        statusList: RelatiStatus[],\n        routeType: RelatiRouteType\n    ): RelatiRoute[];\n}\n\n/** 連結路徑規範 */\nexport let RelatiRouteRule: RelatiRouteRule = {\n    /** 判斷是否符合連結路徑規範 */\n    allow(grid, symbol, statusList, routeType) {\n        switch (routeType) {\n            case BY_COMMON_RELATI:\n                for (let i = 0; i < 24; i++) {\n                    let targetGrid = grid.getGrid(REMOTE_STABLE_ROUTES[i][0]);\n                    let middleGrid1 = grid.getGrid(REMOTE_STABLE_ROUTES[i][1]);\n                    let middleGrid2 = grid.getGrid(REMOTE_STABLE_ROUTES[i][2]);\n\n                    if (\n                        targetGrid &&\n                        targetGrid.symbol == symbol &&\n                        targetGrid.is(statusList, \"any\") &&\n                        middleGrid1.isSpace &&\n                        middleGrid2.isSpace\n                    ) return true;\n                }\n\n                for (let i = 0; i < 8; i++) {\n                    let targetGrid = grid.getGrid(REMOTE_NORMAL_ROUTES[i][0]);\n                    let middleGrid = grid.getGrid(REMOTE_NORMAL_ROUTES[i][1]);\n\n                    if (\n                        targetGrid &&\n                        targetGrid.symbol == symbol &&\n                        targetGrid.is(statusList, \"any\") &&\n                        middleGrid.isSpace\n                    ) return true;\n                }\n            case BY_NORMAL_RELATI:\n                for (let i = 0; i < 8; i++) {\n                    let targetGrid = grid.getGrid(NORMAL_ROUTES[i]);\n\n                    if (\n                        targetGrid &&\n                        targetGrid.symbol == symbol &&\n                        targetGrid.is(statusList, \"any\")\n                    ) return true;\n                }\n        }\n\n        return false;\n    },\n\n    /** 取得符合連結路徑規範的路徑 */\n    trace(grid, symbol, statusList, routeType) {\n        let routes: RelatiRoute[] = [];\n\n        switch (routeType) {\n            case BY_COMMON_RELATI:\n                for (let i = 0; i < 24; i++) {\n                    let targetGrid = grid.getGrid(REMOTE_STABLE_ROUTES[i][0]);\n                    let middleGrid1 = grid.getGrid(REMOTE_STABLE_ROUTES[i][1]);\n                    let middleGrid2 = grid.getGrid(REMOTE_STABLE_ROUTES[i][2]);\n\n                    if (\n                        targetGrid &&\n                        targetGrid.symbol == symbol &&\n                        targetGrid.is(statusList, \"any\") &&\n                        middleGrid1.isSpace &&\n                        middleGrid2.isSpace\n                    ) routes.push({\n                        type: \"remote-stable\",\n                        grids: [targetGrid, middleGrid1, middleGrid2]\n                    });\n                }\n\n                for (let i = 0; i < 8; i++) {\n                    let targetGrid = grid.getGrid(REMOTE_NORMAL_ROUTES[i][0]);\n                    let middleGrid = grid.getGrid(REMOTE_NORMAL_ROUTES[i][1]);\n\n                    if (\n                        targetGrid &&\n                        targetGrid.symbol == symbol &&\n                        targetGrid.is(statusList, \"any\") &&\n                        middleGrid.isSpace\n                    ) routes.push({\n                        type: \"remote-normal\",\n                        grids: [targetGrid, middleGrid]\n                    });\n                }\n            case BY_NORMAL_RELATI:\n                for (let i = 0; i < 8; i++) {\n                    let targetGrid = grid.getGrid(NORMAL_ROUTES[i]);\n\n                    if (\n                        targetGrid &&\n                        targetGrid.symbol == symbol &&\n                        targetGrid.is(statusList, \"any\")\n                    ) routes.push({\n                        type: \"normal\",\n                        grids: [targetGrid]\n                    });\n                }\n        }\n\n        return routes;\n    }\n};","export namespace Page {\n    export function switchTo(pageName: string) {\n        location.hash = pageName;\n    }\n\n    function switchToPage() {\n        let activePage;\n\n        activePage = document.getElementsByClassName(\"page active\")[0];\n        if (activePage) activePage.classList.remove(\"active\");\n\n        activePage = document.querySelector(`${location.hash}-page`);\n        if (activePage) activePage.classList.add(\"active\");\n    }\n\n    window.addEventListener(\"hashchange\", switchToPage);\n    switchToPage();\n}","import { RelatiGrid } from \"../RelatiBoard\";\nimport { RelatiGame } from \"../RelatiGame\";\nimport { RelatiRouteRule } from \"./RelatiRouteRule\";\nimport { RelatiSymbol, RelatiRule, RelatiStatus, RelatiRouteType } from \"../RelatiDefs\";\n\nlet placementStatus: RelatiStatus[] = [\"relati-repeater\"];\n\n/** 設置判定 */\ninterface PlacementRule extends RelatiRule {\n    /**\n     * 判定棋盤格是否可設置符號\n     * @param grid 棋盤格\n     * @param symbol 符號\n     * @param routeType 連結路徑類型\n     */\n    allow(\n        grid: RelatiGrid,\n        symbol: RelatiSymbol,\n        routeType: RelatiRouteType\n    ): boolean;\n\n    /**\n     * 取得可設置符號的棋盤格\n     * @param game 遊戲主體\n     * @param symbol 符號\n     */\n    trace(\n        game: RelatiGame,\n        symbol: RelatiSymbol,\n        routeType?: RelatiRouteType\n    ): RelatiGrid[];\n}\n\n/** 設置判定 */\nexport let PlacementRule: PlacementRule = {\n    /**\n     * 判定棋盤格是否可設置符號\n     * @param grid 棋盤格\n     * @param symbol 符號\n     * @param routeType 連結路徑類型\n     */\n    allow(grid, symbol, routeType) {\n        return !grid.symbol && RelatiRouteRule.allow(\n            grid, symbol, placementStatus, routeType\n        );\n    },\n\n    /**\n     * 取得可設置符號的棋盤格\n     * @param game 遊戲主體\n     * @param symbol 符號\n     * @param routeType 連結路徑類型\n     */\n    trace(game, symbol, routeType?) {\n        let grids: RelatiGrid[] = [];\n\n        for (let grid of game.board.grids) {\n            if (!grid.symbol && PlacementRule.allow(\n                grid, symbol, routeType || game.routeType\n            )) grids.push(grid);\n        }\n\n        return grids;\n    }\n};","const SVGNS = \"http://www.w3.org/2000/svg\";\ntype SVGAttr = { [name: string]: string };\n\n/**\n * 建立SVG元素\n * @param tagName SVG標籤名稱\n * @param attribute SVG屬性\n */\nexport function createSVG<T extends keyof SVGElementTagNameMap>(tagName: T, attribute?: SVGAttr): SVGElementTagNameMap[T] {\n    let element = document.createElementNS(SVGNS, tagName);\n    if (attribute) updateSVG(element, attribute);\n    return element;\n}\n\n/**\n * 變更SVG屬性\n * @param element SVG元素\n * @param attribute SVG屬性\n */\nexport function updateSVG(element: SVGElement, attribute: SVGAttr) {\n    for (let name in attribute) {\n        element.setAttribute(name, attribute[name]);\n    }\n}\n\n/**\n * 增加SVG子元素\n * @param element SVG元素\n * @param childElements SVG子元素\n */\nexport function appendSVGChild(element: SVGElement, childElements: SVGElement[]) {\n    for (let childElement of childElements) {\n        element.appendChild(childElement);\n    }\n}\n\n/**\n * 移除SVG子元素\n * @param element SVG元素\n */\nexport function removeSVGChild(element: SVGElement) {\n    let elementCount = element.childNodes.length;\n\n    while (elementCount-- > 0) {\n        element.removeChild(element.childNodes[0]);\n    }\n}","export namespace MessageBox {\n    export let view: HTMLElement = document.getElementById(\"message-box\") as HTMLElement;\n    export let messageContent: HTMLElement = document.getElementById(\"message-content\") as HTMLElement;\n    export let acceptButton: HTMLElement = document.getElementById(\"message-accept\") as HTMLElement;\n    export let rejectButton: HTMLElement = document.getElementById(\"message-reject\") as HTMLElement;\n    export let verifyButton: HTMLElement = document.getElementById(\"message-verify\") as HTMLElement;\n\n    export let isShow: boolean = false;\n\n    export type MessageCallback = (result: string) => void;\n    let callback: MessageCallback | null;\n\n    export function show(type: string, message: string, response: MessageCallback | null) {\n        view.className = type;\n        messageContent.innerText = message;\n        messageContent.style.display = message ? \"\" : \"none\";\n        callback = response;\n        isShow = true;\n    }\n\n    export function hide() {\n        view.className = \"none\";\n        isShow = false;\n    }\n\n    export function response(result: string) {\n        if (callback) callback(result);\n        callback = null;\n        hide();\n    }\n\n    acceptButton.addEventListener(\"click\", event => response(\"accept\"));\n    rejectButton.addEventListener(\"click\", event => response(\"reject\"));\n    verifyButton.addEventListener(\"click\", event => response(\"verify\"));\n}","import { RelatiBoard, RelatiGrid } from \"./RelatiBoard\";\nimport { RelatiAction, RelatiEffect, RelatiRouteType, AllRelatiStatus, RelatiGameResult } from \"./RelatiDefs\";\nimport { RelatiPlayer } from \"./RelatiPlayer\";\nimport { GAME_RESULT_NONE, WinnerDecision } from \"./rule/WinnerDecision\";\nimport { DestoryRepeater, RestoreRepeater } from \"./skill/Relati\";\nimport { Placement } from \"./skill/Placement\";\n\n/** 遊戲狀態 */\ninterface RelatiGameState {\n    turn: number;\n    type: string;\n    grid: RelatiGrid;\n}\n\n/** 遊戲主體 */\nexport class RelatiGame {\n    /** 回合 */\n    public turn = 0;\n\n    /** 紀錄 */\n    public history: RelatiGameState[] = [];\n\n    /** 已選擇棋盤格 */\n    public selectedGrid?: RelatiGrid;\n\n    /**\n     * 選取棋盤格放置\n     * @param grid 棋盤格\n     */\n    public selectGrid?: (grid: RelatiGrid) => void;\n\n    /**\n     * 遊戲回合開始事件\n     * @param grid 棋盤格\n     */\n    public onturnstart?: (grid: RelatiGrid) => void;\n\n    /**\n     * 遊戲回合結束事件\n     * @param grid 棋盤格\n     */\n    public onturnend?: (grid: RelatiGrid) => void;\n\n    /**\n     * 棋盤格選取事件\n     * @param grid 棋盤格\n     */\n    public ongridselect?: (grid: RelatiGrid) => void;\n\n    /**\n     * 遊戲開始事件\n     */\n    public onstart?: Function;\n\n    /**\n     * 遊戲結束事件\n     */\n    public onend?: (gameResult: RelatiGameResult) => void;\n\n    constructor(\n        /** 棋盤 */\n        public board: RelatiBoard,\n        /** 玩家 */\n        public players: RelatiPlayer[],\n        /** Relati路徑類型 */\n        public routeType: RelatiRouteType,\n        /** 角色固有技能 */\n        public roleInitEffects: RelatiEffect[],\n        /** 角色行動 */\n        public roleActions: RelatiAction[],\n        /** 角色觸發技能 */\n        public rolePassEffects: RelatiEffect[]\n    ) { this.start(); }\n\n    /** 開始 */\n    async start() {\n        let gameResult: RelatiGameResult = GAME_RESULT_NONE;\n        if (this.onstart) this.onstart();\n\n        while (gameResult == GAME_RESULT_NONE) {\n            let grid = this.selectedGrid || await this.gridSelect();\n\n            if (!grid) continue;\n\n            if (this.onturnstart) this.onturnstart(grid);\n\n            this.selectedGrid = grid;\n            for (let effect of this.roleInitEffects) await effect.do(this);\n\n            this.selectedGrid = grid;\n\n            let actionValid = false;\n\n            for (let action of this.roleActions) {\n                if (await action.do(grid, this)) {\n                    actionValid = true;\n                    break;\n                }\n            }\n\n            if (!actionValid) continue;\n\n            this.selectedGrid = grid;\n            for (let effect of this.rolePassEffects) await effect.do(this);\n\n            this.turn++;\n\n            delete this.selectedGrid;\n            gameResult = WinnerDecision.state(this);\n            if (this.onturnend) this.onturnend(grid);\n        }\n\n        if (this.onend) this.onend(gameResult);\n        return gameResult;\n    }\n\n    /** 重新開始 */\n    restart() {\n        this.turn = 0;\n\n        for (let grid of this.board.grids) {\n            grid.symbol = \"\";\n            grid.lost(AllRelatiStatus);\n        }\n\n        this.start();\n    }\n\n    /** 等待格子選取 */\n    gridSelect() {\n        return new Promise<RelatiGrid>(select => {\n            this.selectGrid = grid => {\n                select(grid);\n                if (this.ongridselect) this.ongridselect(grid);\n            };\n        });\n    }\n\n    /** 目前玩家 */\n    get nowPlayer() {\n        return this.players[this.turn % 2];\n    }\n}","/**\n * 棋盤格方向\n * C: (x = 0, y = 0)\n * F: (x = x, y - 1)\n * B: (x = x, y + 1)\n * R: (x + 1, y = y)\n * L: (x - 1, y = y)\n */\nexport enum GRID_DRCT {\n    DRCT_C = 0x0000,\n    DRCT_F = 0x1000,\n    DRCT_B = 0x0100,\n    DRCT_R = 0x0010,\n    DRCT_L = 0x0001,\n    DRCT_FR = 0x1010,\n    DRCT_FL = 0x1001,\n    DRCT_BR = 0x0110,\n    DRCT_BL = 0x0101,\n\n    DRCT_2F = 0x2000,\n    DRCT_2B = 0x0200,\n    DRCT_2R = 0x0020,\n    DRCT_2L = 0x0002,\n    DRCT_2FR = 0x2020,\n    DRCT_2FL = 0x2002,\n    DRCT_2BR = 0x0220,\n    DRCT_2BL = 0x0202,\n\n    DRCT_FFR = 0x2010,\n    DRCT_FFL = 0x2001,\n    DRCT_BBR = 0x0210,\n    DRCT_BBL = 0x0201,\n    DRCT_FRR = 0x1020,\n    DRCT_FLL = 0x1002,\n    DRCT_BRR = 0x0120,\n    DRCT_BLL = 0x0102\n}\n\n/** 棋盤格 */\nexport class Grid {\n    /** 原始陣列索引 */\n    public readonly i: number;\n\n    constructor(\n        /** 所屬棋盤 */\n        public readonly board: GridBoard,\n        /** X座標 */\n        public readonly x: number,\n        /** Y座標 */\n        public readonly y: number\n    ) {\n        this.i = x * board.height + y;\n    }\n\n    /**\n     * 取得相對位置的棋盤格\n     * @param drct 方向，使用 GRID_DRCT 可簡單取得\n     */\n    getGrid(drct: number) {\n        let f = (0xF000 & drct) >> 12;\n        let b = (0x0F00 & drct) >> 8;\n        let r = (0x00F0 & drct) >> 4;\n        let l = (0x000F & drct);\n\n        let x = this.x + r - l;\n        let y = this.y + b - f;\n\n        return this.board.getGrid(x, y);\n    }\n}\n\n/** 棋盤 */\nexport class GridBoard {\n    /** 所有棋盤格 */\n    public readonly grids: Grid[];\n    /** 棋盤格總數 */\n    public readonly length: number;\n\n    constructor(\n        /** 棋盤寬度 */\n        public readonly width: number,\n        /** 棋盤高度 */\n        public readonly height: number\n    ) {\n        let grids: Grid[] = [];\n\n        this.grids = grids;\n        this.length = width * height;\n\n        for (let x = 0; x < width; x++) {\n            for (let y = 0; y < height; y++) {\n                let grid = new Grid(this, x, y);\n                grids[grid.i] = grid;\n            }\n        }\n    }\n\n    /**\n     * 取得絕對位置的棋盤格\n     * @param x X座標\n     * @param y Y座標\n     */\n    getGrid(x: number, y: number) {\n        if (\n            x < 0 || x >= this.width ||\n            y < 0 || y >= this.height\n        ) return null;\n\n        let i = x * this.height + y;\n        return this.grids[i];\n    }\n}","import { Grid, GridBoard } from \"../core/GridBoard\";\nimport { RelatiStatus, RelatiSymbol } from \"./RelatiDefs\";\n\n/** Relati棋盤格 */\nexport interface RelatiGrid extends Grid {\n    getGrid(drct: number): RelatiGrid;\n}\n\nexport class RelatiGrid extends Grid {\n    /** 符號 */\n    public symbol: RelatiSymbol = \"\";\n\n    /** 狀態存儲 */\n    public status: { [status: string]: boolean } = {};\n\n    constructor(board: RelatiBoard, x: number, y: number) {\n        super(board, x, y);\n    }\n\n    /**\n     * 判斷是否符合狀態\n     * @param statusName 狀態名稱\n     */\n    is(statusName: RelatiStatus): boolean;\n\n    /**\n     * 判斷是否符合所有狀態或任一狀態\n     * @param statusNameList 狀態名稱列表\n     * @param matchType 所有狀態 | 任一狀態\n     */\n    is(statusNameList: RelatiStatus[], matchType: \"all\" | \"any\"): boolean;\n\n    is(statusName: RelatiStatus | RelatiStatus[], matchType?: \"all\" | \"any\") {\n        if (typeof statusName === \"string\") return this.status[statusName];\n\n        let statusNameList = statusName;\n\n        if (matchType === \"all\") {\n            for (let status of statusNameList) {\n                if (!this.status[status]) return false;\n            }\n\n            return true;\n        } else {\n            for (let status of statusNameList) {\n                if (this.status[status]) return true;\n            }\n\n            return false;\n        }\n    }\n\n    /**\n     * 獲得狀態\n     * @param status 狀態名稱\n     */\n    gain(status: RelatiStatus): void;\n\n    /**\n     * 獲得多個狀態\n     * @param statusNameList 狀態名稱列表\n     */\n    gain(statusNameList: RelatiStatus[]): void;\n\n    gain(statusName: RelatiStatus | RelatiStatus[]) {\n        if (typeof statusName === \"string\") {\n            return this.status[statusName] = true;\n        }\n\n        let statusNameList = statusName;\n\n        for (let status of statusNameList) {\n            this.status[status] = true;\n        }\n    }\n\n    /**\n     * 失去狀態\n     * @param status 狀態名稱\n     */\n    lost(status: RelatiStatus): void;\n\n    /**\n     * 失去多個狀態\n     * @param statusNameList 狀態名稱列表\n     */\n    lost(statusNameList: RelatiStatus[]): void;\n\n    lost(statusName: RelatiStatus | RelatiStatus[]) {\n        if (typeof statusName === \"string\") {\n            return this.status[statusName] = false;\n        }\n\n        let statusNameList = statusName;\n\n        for (let status of statusNameList) {\n            this.status[status] = false;\n        }\n    }\n\n    /** 該格視為空格 */\n    get isSpace() {\n        return (\n            this.symbol === \"\" ||\n            !this.is([\"relati-receiver\", \"relati-launcher\"], \"any\")\n        );\n    }\n}\n\n/** Relati棋盤 */\nexport interface RelatiBoard extends GridBoard {\n    grids: RelatiGrid[];\n    getGrid(x: number, y: number): RelatiGrid;\n}\n\nexport class RelatiBoard extends GridBoard {\n    constructor(width: number, height: number) {\n        super(width, height);\n\n        for (let x = 0; x < width; x++) {\n            for (let y = 0; y < height; y++) {\n                let grid: RelatiGrid = new RelatiGrid(this, x, y);\n                this.grids[grid.i] = grid;\n            }\n        }\n    }\n}","import { RelatiSymbol } from \"./RelatiDefs\";\nimport { RelatiGrid } from \"./RelatiBoard\";\n\nexport class RelatiPlayer {\n    public leader?: RelatiGrid;\n    public status: { [status: string]: boolean } = {};\n    public points: { [points: string]: number } = {};\n    public params: { [params: string]: string } = {};\n    constructor(public symbol: RelatiSymbol) { }\n}","import { RelatiGame } from \"../main/RelatiGame\";\nimport { createSVG, updateSVG, appendSVGChild, removeSVGChild } from \"../core/SVGProcess\";\nimport { RelatiBoard, RelatiGrid } from \"../main/RelatiBoard\";\nimport { RelatiSymbol } from \"../main/RelatiDefs\";\n\nexport class RelatiBoardView {\n    public context: SVGSVGElement = createSVG(\"svg\");\n    public gridViews: RelatiGridView[] = [];\n    public layers: SVGGElement[];\n\n    constructor(public game: RelatiGame, public container: HTMLElement) {\n        let { board } = game;\n\n        updateSVG(this.context, {\n            \"width\": `${board.width * 5}`,\n            \"height\": `${board.height * 5}`\n        });\n\n        let routesLayer = createSVG(\"g\");\n        let dotsLayer = createSVG(\"g\");\n        let linesLayer = createSVG(\"g\");\n        let gridsLayer = createSVG(\"g\");\n        appendGridLine(board, linesLayer);\n\n        this.layers = [routesLayer, dotsLayer, linesLayer, gridsLayer];\n        appendSVGChild(this.context, this.layers);\n\n        for (let grid of board.grids) {\n            let gridView = new RelatiGridView(grid);\n            gridsLayer.appendChild(gridView.context);\n            gridsLayer.appendChild(gridView.feature);\n            this.gridViews.push(gridView);\n        }\n\n        this.container.appendChild(this.context);\n\n        this.resize();\n        window.addEventListener(\"resize\", this.resize.bind(this));\n    }\n\n    resize() {\n        let { container, game: { board: { width, height } } } = this;\n\n        this.context.style.transform = \"scale(\" + Math.min(\n            container.clientWidth / (width * 5),\n            container.clientHeight / (height * 5)\n        ) * 0.95 + \")\";\n    }\n\n    update() {\n        for (let gridView of this.gridViews) gridView.update();\n    }\n\n    remove() {\n        for (let gridView of this.gridViews) gridView.remove();\n        removeSVGChild(this.layers[0]);\n        removeSVGChild(this.layers[1]);\n    }\n}\n\nlet lineAttr = {\n    \"d\": \"\",\n    \"stroke\": \"#888\",\n    \"stroke-width\": \"0.4\"\n};\n\nfunction appendGridLine(board: RelatiBoard, linesLayer: SVGGElement) {\n    for (let x = 1; x < board.width; x++) {\n        lineAttr[\"d\"] = `M ${x * 5} 0 V ${board.height * 5}`;\n        let line = createSVG(\"path\", lineAttr);\n        linesLayer.appendChild(line);\n    }\n\n    for (let y = 1; y < board.height; y++) {\n        lineAttr[\"d\"] = `M 0 ${y * 5} H ${board.width * 5}`;\n        let line = createSVG(\"path\", lineAttr);\n        linesLayer.appendChild(line);\n    }\n}\n\nexport class RelatiGridView {\n    public feature: SVGGElement = createSVG(\"g\");\n    public context: SVGGElement = createSVG(\"g\");\n    public symbol: RelatiSymbol = \"\";\n    public status: { [status: string]: boolean } = {};\n\n    constructor(public grid: RelatiGrid) {\n        this.symbol = grid.symbol;\n        this.status = { ...grid.status };\n        this.update();\n    }\n\n    update() {\n        let { grid } = this;\n\n        if (\n            this.symbol == grid.symbol &&\n            this.status[\"relati-launcher\"] ==\n            grid.status[\"relati-launcher\"] &&\n            this.status[\"relati-repeater\"] ==\n            grid.status[\"relati-repeater\"] &&\n            this.status[\"relati-receiver\"] ==\n            grid.status[\"relati-receiver\"] &&\n            this.status[\"attack-selected\"] ==\n            grid.status[\"attack-selected\"]\n        ) return;\n\n        let symbolAttr = {\n            \"d\": \"\",\n            \"fill\": \"none\",\n            \"stroke\": \"\",\n            \"stroke-width\": \"0.6\"\n        };\n\n        let srtX = grid.x * 5 + 1;\n        let srtY = grid.y * 5 + 1;\n        let endX = grid.x * 5 + 4;\n        let endY = grid.y * 5 + 4;\n\n        switch (grid.symbol) {\n            case \"\": {\n                removeSVGChild(this.context);\n                break;\n            }\n\n            case \"O\": {\n                symbolAttr[\"d\"] = (\n                    `M ${srtX + 1.5} ${srtY + 1.5} ` +\n                    \"m 0 -1.5 \" +\n                    \"a 1.5 1.5 0 0 1, 0 3 \" +\n                    \"a 1.5 1.5 0 0 1, 0 -3\"\n                );\n                symbolAttr[\"stroke\"] = \"crimson\";\n                break;\n            }\n\n            case \"X\": {\n                symbolAttr[\"d\"] = (\n                    `M ${srtX} ${srtY} L ${endX} ${endY} ` +\n                    `M ${endX} ${srtY} L ${srtX} ${endY}`\n                );\n                symbolAttr[\"stroke\"] = \"royalblue\";\n                break;\n            }\n        }\n\n        if (!grid.is(\"relati-repeater\")) symbolAttr[\"stroke\"] = \"#666\";\n\n        if (\n            !grid.is([\"relati-launcher\", \"relati-receiver\"], \"any\")\n        ) symbolAttr[\"stroke\"] = \"#bbb\";\n\n        if (!this.symbol) {\n            if (!grid.isSpace) {\n                if (grid.is(\"relati-launcher\")) {\n                    symbolAttr[\"stroke-width\"] = \"1.2\";\n                    this.context.appendChild(createSVG(\"path\", symbolAttr));\n\n                    symbolAttr[\"stroke-width\"] = \"0.6\";\n                    symbolAttr[\"stroke\"] = \"#f2f2f2\";\n                    this.context.appendChild(createSVG(\"path\", symbolAttr));\n                } else if (grid.is(\"relati-repeater\")) {\n                    this.context.appendChild(createSVG(\"path\", symbolAttr));\n                } else if (grid.is(\"relati-receiver\")) {\n                    this.context.appendChild(createSVG(\"path\", symbolAttr));\n                } else {\n                    this.context.appendChild(createSVG(\"path\", symbolAttr));\n                }\n            }\n        } else {\n            let color = symbolAttr[\"stroke\"];\n\n            updateSVG(\n                this.context.childNodes[0] as SVGElement,\n                { \"stroke\": color }\n            );\n\n            // if (grid.is(\"attack-selected\")) {\n            //     symbolAttr[\"stroke-width\"] = \"0.4\";\n            //     symbolAttr[\"d\"] = (\n            //         `M ${srtX - 0.5} ${srtY + 0.5} v -1 h 1` +\n            //         `M ${endX + 0.5} ${srtY + 0.5} v -1 h -1` +\n            //         `M ${srtX - 0.5} ${endY - 0.5} v 1 h 1` +\n            //         `M ${endX + 0.5} ${endY - 0.5} v 1 h -1`\n            //     );\n\n            //     this.feature.appendChild(createSVG(\"path\", symbolAttr));\n            // } else removeSVGChild(this.feature);\n        }\n\n        this.symbol = grid.symbol;\n        this.status = { ...grid.status };\n    }\n\n    remove() {\n        this.symbol = \"\";\n        this.status = {};\n        removeSVGChild(this.context);\n        removeSVGChild(this.feature);\n    }\n}","import { createSVG, removeSVGChild } from \"../core/SVGProcess\";\nimport { RelatiGrid } from \"../main/RelatiBoard\";\nimport { RelatiGame } from \"../main/RelatiGame\";\nimport { RelatiRouteRule } from \"../main/rule/RelatiRouteRule\";\nimport { RelatiRouteType, RelatiSymbol } from \"../main/RelatiDefs\";\n\nconst SYMBOL_COLOR = {\n    \"\": \"#666\",\n    \"O\": \"crimson\",\n    \"X\": \"royalblue\"\n};\n\nlet dotAttr = {\n    \"cx\": \"\",\n    \"cy\": \"\",\n    \"r\": \"0.5\",\n    \"fill\": \"\"\n};\n\nfunction createDot(x: number, y: number, color: string) {\n    dotAttr[\"cx\"] = `${x * 5 + 2.5}`;\n    dotAttr[\"cy\"] = `${y * 5 + 2.5}`;\n    dotAttr[\"fill\"] = color;\n    return createSVG(\"circle\", dotAttr);\n}\n\nexport function createHintEffect(grids: RelatiGrid[], symbol: RelatiSymbol, view: SVGElement) {\n    let color = SYMBOL_COLOR[symbol];\n\n    for (let { x, y, symbol } of grids) {\n        if (symbol) continue;\n        view.appendChild(createDot(x, y, color));\n    }\n}\n\nlet lineAttr = {\n    \"d\": \"\",\n    \"stroke-width\": \"0.5\",\n    \"stroke\": \"\",\n    \"fill\": \"none\",\n    \"class\": \"relati-effect-line\"\n};\n\nfunction createLine(source: RelatiGrid, traces: RelatiGrid[], color: string, view: SVGElement) {\n    lineAttr[\"d\"] = `M ${source.x * 5 + 2.5} ${source.y * 5 + 2.5}`;\n    lineAttr[\"stroke\"] = color;\n\n    for (let grid of traces) {\n        lineAttr[\"d\"] += ` L ${grid.x * 5 + 2.5} ${grid.y * 5 + 2.5}`;\n    }\n\n    let path = createSVG(\"path\", lineAttr);\n    view.appendChild(path);\n}\n\nfunction createRelatiLine(grid: RelatiGrid, color: string, view: SVGElement, routeType: RelatiRouteType, turn: number, game: RelatiGame) {\n    if (grid.is(\"effect-activate\") || game.turn > turn) return;\n    grid.gain(\"effect-activate\");\n\n    setTimeout(() => {\n        if (game.turn > turn) return;\n        let traces = RelatiRouteRule.trace(grid, grid.symbol, [\"relati-receiver\"], routeType);\n\n        for (let { grids } of traces) {\n            grids.reverse();\n\n            let targetGrid = grids[grids.length - 1];\n\n            if (!targetGrid.is(\"effect-activate\")) {\n                createLine(grid, grids, color, view);\n                createRelatiLine(targetGrid, color, view, routeType, turn, game);\n            }\n        }\n    }, 250);\n}\n\nexport function createRelatiEffect(symbol: RelatiSymbol, view: SVGElement, game: RelatiGame) {\n    let { board: { grids }, routeType, turn } = game;\n    let color = SYMBOL_COLOR[symbol];\n\n    for (let grid of grids) grid.lost(\"effect-activate\");\n\n    for (let grid of grids) {\n        if (grid.is(\"relati-launcher\") && grid.symbol == symbol) {\n            createRelatiLine(grid, color, view, routeType, turn, game);\n        }\n    }\n}","import { RelatiAction } from \"../RelatiDefs\";\nimport { RelatiGrid } from \"../RelatiBoard\";\nimport { RelatiGame } from \"../RelatiGame\";\nimport { PlacementRule } from \"../rule/PlacementRule\";\n\nexport let Placement: RelatiAction = {\n    do(grid: RelatiGrid, game: RelatiGame) {\n        if (!grid.isSpace) return false;\n\n        let { nowPlayer: { symbol }, routeType } = game;\n\n        if (game.turn < 2) {\n            grid.symbol = symbol;\n            grid.gain(\"relati-launcher\");\n        } else if (PlacementRule.allow(grid, symbol, routeType)) {\n            grid.symbol = symbol;\n            grid.gain(\"relati-receiver\");\n        } else return false;\n\n        game.history.push({\n            turn: game.turn,\n            type: \"placement\",\n            grid\n        });\n\n        return true;\n    }\n};","import { RelatiGrid } from \"../RelatiBoard\";\nimport { RelatiRouteRule, RelatiRoute } from \"../rule/RelatiRouteRule\";\nimport { RelatiRouteType, RelatiEffect, RelatiStatus } from \"../RelatiDefs\";\n\nlet restoreStatus: RelatiStatus[] = [\"relati-receiver\"];\n\n/**\n * 恢復棋盤格Relati的中繼機能\n * @param grid 棋盤格\n * @param routeType 路徑類型\n */\nfunction restore(grid: RelatiGrid, routeType: RelatiRouteType) {\n    if (grid.is(\"relati-repeater\")) return;\n    grid.gain(\"relati-repeater\");\n\n    let traces: RelatiRoute[] = RelatiRouteRule.trace(\n        grid, grid.symbol, restoreStatus, routeType\n    );\n\n    for (let route of traces) restore(route.grids[0], routeType);\n}\n\n/** 恢復Relati中繼機能 */\nexport let RestoreRepeater: RelatiEffect = {\n    do({ board, routeType }) {\n        for (let grid of board.grids) {\n            if (grid.is(\"relati-launcher\")) {\n                restore(grid, routeType);\n            }\n        }\n    }\n};\n\n/** 破壞Relati中繼機能 */\nexport let DestoryRepeater: RelatiEffect = {\n    do({ board }) {\n        for (let grid of board.grids) {\n            grid.lost(\"relati-repeater\");\n        }\n    }\n};","import { Page } from \"./ts/view/Page\";\nimport { MessageBox } from \"./ts/view/MessageBox\";\n\nimport \"./ts/page/MainPage\";\nimport \"./ts/page/GamePage\";\nimport \"./ts/page/HelpPage\";\n\nif (!location.hash) Page.switchTo(\"main\");\n(window as any).MessageBox = MessageBox;","import { Page } from \"../view/Page\";\n\nconst toGamePageButton: HTMLElement = document.getElementById(\"main-to-game\") as HTMLElement;\nconst toHelpPageButton: HTMLElement = document.getElementById(\"main-to-help\") as HTMLElement;\n\ntoGamePageButton.addEventListener(\"click\", event => Page.switchTo(\"game\"));\ntoHelpPageButton.addEventListener(\"click\", event => Page.switchTo(\"help\"));","import { Page } from \"../view/Page\";\nimport { RelatiGame } from \"../main/RelatiGame\";\nimport { RelatiBoard } from \"../main/RelatiBoard\";\nimport { RelatiPlayer } from \"../main/RelatiPlayer\";\nimport { BY_COMMON_RELATI } from \"../main/rule/RelatiRouteRule\";\nimport { RelatiBoardView } from \"../view/RelatiBoardView\";\nimport { RelatiSymbol, RelatiEffect, RelatiAction } from \"../main/RelatiDefs\";\nimport { createHintEffect, createRelatiEffect } from \"../view/RelatiEffectView\";\nimport { PlacementRule } from \"../main/rule/PlacementRule\";\nimport { MessageBox } from \"../view/MessageBox\";\nimport { Placement } from \"../main/skill/Placement\";\nimport { DestoryRepeater, RestoreRepeater } from \"../main/skill/Relati\";\nimport { removeSVGChild } from \"../core/SVGProcess\";\n\nconst toMainPageButton: HTMLElement = document.getElementById(\"game-to-main\") as HTMLElement;\n\ntoMainPageButton.addEventListener(\"click\", () => {\n    MessageBox.show(\"confirm accept reject\", \"確認離開？\", message => {\n        if (message == \"accept\") Page.switchTo(\"main\");\n    });\n});\n\nlet board = new RelatiBoard(9, 9);\nlet players = [new RelatiPlayer(\"O\"), new RelatiPlayer(\"X\")];\nlet roleInitEffects: RelatiEffect[] = [];\nlet roleActions: RelatiAction[] = [Placement];\nlet rolePassEffects: RelatiEffect[] = [DestoryRepeater, RestoreRepeater];\n\nlet game = new RelatiGame(\n    board, players, BY_COMMON_RELATI,\n    roleInitEffects,\n    roleActions,\n    rolePassEffects\n);\n\nlet container = document.getElementById(\"game-board\") as HTMLElement;\nlet boardView = new RelatiBoardView(game, container);\n\nwindow.addEventListener(\"hashchange\", () => {\n    if (location.hash == \"#game\") game.restart();\n});\n\nboardView.context.addEventListener(\"click\", function (event: MouseEvent) {\n    let x: number = Math.floor(event.offsetX / 5),\n        y: number = Math.floor(event.offsetY / 5),\n        grid = board.getGrid(x, y);\n\n    if (MessageBox.isShow) return;\n    if (game.selectGrid) game.selectGrid(grid);\n});\n\ngame.onstart = boardView.remove.bind(boardView);\n\ngame.onend = gameResult => {\n    let messageIcon = \"\";\n    let messageContent = \"\";\n\n    switch (gameResult) {\n        case 1:\n            messageIcon = \"owin\";\n            messageContent = \"圈方獲勝！\";\n            break;\n        case 2:\n            messageIcon = \"xwin\";\n            messageContent = \"叉方獲勝！\";\n            break;\n        case 3:\n            messageIcon = \"draw\";\n            messageContent = \"無人獲勝！\";\n            break;\n    }\n\n    MessageBox.show(`${messageIcon} accept reject`, messageContent, message => {\n        if (message == \"accept\") game.restart();\n    });\n};\n\nlet prevPlayerSymbol: RelatiSymbol = \"\";\n\ngame.onturnstart = () => prevPlayerSymbol = game.nowPlayer.symbol;\ngame.ongridselect = boardView.update.bind(boardView);\n\ngame.onturnend = async () => {\n    boardView.update();\n\n    let symbol = game.nowPlayer.symbol;\n    let grids = PlacementRule.trace(\n        game, symbol, BY_COMMON_RELATI\n    );\n\n    removeSVGChild(boardView.layers[0]);\n    removeSVGChild(boardView.layers[1]);\n\n    createHintEffect(grids, symbol, boardView.layers[1]);\n    createRelatiEffect(prevPlayerSymbol, boardView.layers[0], game);\n};\n\n(window as any).game = game;","import { RelatiGrid } from \"./RelatiBoard\";\nimport { RelatiGame } from \"./RelatiGame\";\n\nexport type RelatiStatus = (\n    \"relati-launcher\" |\n    \"relati-repeater\" |\n    \"relati-receiver\" |\n    \"attack-selected\" |\n    \"effect-activate\"\n);\n\nexport type RelatiSymbol = \"\" | \"O\" | \"X\";\n\nexport interface RelatiRule {\n    allow?(...state: any[]): boolean;\n    trace?(...state: any[]): any[];\n    state?(...state: any[]): number;\n}\n\nexport interface RelatiAction {\n    do(grid: RelatiGrid, game: RelatiGame, ...state: any[]): boolean | Promise<boolean>;\n}\n\nexport interface RelatiEffect {\n    do(game: RelatiGame, ...state: any[]): void;\n}\n\nexport type RelatiRouteType = 0 | 1;\n\nexport type RelatiGameResult = 0 | 1 | 2 | 3;\n\nexport let RelatiStatusList: RelatiStatus[] = [\n    \"relati-launcher\",\n    \"relati-repeater\",\n    \"relati-receiver\",\n    \"attack-selected\",\n    \"effect-activate\"\n];\n\nexport let AllRelatiStatus: RelatiStatus[] = RelatiStatusList;\n\nexport let RelatiSymbolList: RelatiSymbol[] = [\"\", \"O\", \"X\"];","import { RelatiRule, RelatiGameResult } from \"../RelatiDefs\";\nimport { RelatiGame } from \"../RelatiGame\";\nimport { PlacementRule } from \"./PlacementRule\";\n\n/** 尚無結果 */\nexport const GAME_RESULT_NONE: RelatiGameResult = 0;\n\n/** 玩家O勝利 */\nexport const GAME_RESULT_OWIN: RelatiGameResult = 1;\n\n/** 玩家X勝利 */\nexport const GAME_RESULT_XWIN: RelatiGameResult = 2;\n\n/** 平手 */\nexport const GAME_RESULT_DRAW: RelatiGameResult = 3;\n\n/** 勝負判定 */\ninterface WinnerDecision extends RelatiRule {\n    /**\n     * 判定遊戲是否已分出勝負\n     * @param game 遊戲主體\n     */\n    state(game: RelatiGame): RelatiGameResult;\n}\n\n/** 勝負判定 */\nexport let WinnerDecision: WinnerDecision = {\n    /**\n     * 判定遊戲是否已分出勝負\n     * @param game 遊戲主體\n     */\n    state(game: RelatiGame) {\n        if (game.turn < 2) return GAME_RESULT_NONE;\n\n        let { nowPlayer } = game;\n\n        let playerOPlaceableGrids = PlacementRule.trace(game, \"O\");\n        let playerXPlaceableGrids = PlacementRule.trace(game, \"X\");\n\n        let playerOHasPlaceableGrid = playerOPlaceableGrids[0] != undefined;\n        let playerXHasPlaceableGrid = playerXPlaceableGrids[0] != undefined;\n\n        if (\n            playerOHasPlaceableGrid &&\n            playerXHasPlaceableGrid\n        ) return GAME_RESULT_NONE;\n\n        if (nowPlayer.symbol == \"O\") {\n            if (playerOHasPlaceableGrid) return GAME_RESULT_NONE;\n            else if (playerXHasPlaceableGrid) return GAME_RESULT_XWIN;\n        } else if (nowPlayer.symbol == \"X\") {\n            if (playerXHasPlaceableGrid) return GAME_RESULT_NONE;\n            else if (playerOHasPlaceableGrid) return GAME_RESULT_OWIN;\n        }\n\n        return GAME_RESULT_DRAW;\n    }\n}","import { Page } from \"../view/Page\";\nimport { MessageBox } from \"../view/MessageBox\";\nimport { RelatiGame } from \"../main/RelatiGame\";\nimport { RelatiBoard, RelatiGrid } from \"../main/RelatiBoard\";\nimport { RelatiPlayer } from \"../main/RelatiPlayer\";\nimport { BY_COMMON_RELATI } from \"../main/rule/RelatiRouteRule\";\nimport { RelatiBoardView } from \"../view/RelatiBoardView\";\nimport { RelatiSymbol, RelatiEffect, RelatiAction } from \"../main/RelatiDefs\";\nimport { createHintEffect, createRelatiEffect } from \"../view/RelatiEffectView\";\nimport { PlacementRule } from \"../main/rule/PlacementRule\";\nimport { Placement } from \"../main/skill/Placement\";\nimport { DestoryRepeater, RestoreRepeater } from \"../main/skill/Relati\";\nimport { updateSVG, removeSVGChild } from \"../core/SVGProcess\";\nimport { GAME_RESULT_DRAW } from \"../main/rule/WinnerDecision\";\n\nconst toMainPageButton: HTMLElement = document.getElementById(\"help-to-main\") as HTMLElement;\nconst helpMessaageView: HTMLElement = document.getElementById(\"help-desc\") as HTMLElement;\n\ntoMainPageButton.addEventListener(\"click\", event => {\n    MessageBox.show(\"confirm accept reject\", \"確認離開？\", message => {\n        if (message == \"accept\") Page.switchTo(\"main\");\n    });\n});\n\ntoMainPageButton.addEventListener(\"click\", () => {\n    MessageBox.show(\"confirm accept reject\", \"確認離開？\", message => {\n        if (message == \"accept\") Page.switchTo(\"main\");\n    });\n});\n\nlet board = new RelatiBoard(9, 9);\nlet players = [new RelatiPlayer(\"O\"), new RelatiPlayer(\"X\")];\nlet roleInitEffects: RelatiEffect[] = [];\nlet roleActions: RelatiAction[] = [Placement];\nlet rolePassEffects: RelatiEffect[] = [DestoryRepeater, RestoreRepeater];\n\nlet game = new RelatiGame(\n    board, players, BY_COMMON_RELATI,\n    roleInitEffects,\n    roleActions,\n    rolePassEffects\n);\n\nlet container = document.getElementById(\"help-board\") as HTMLElement;\nlet boardView = new RelatiBoardView(game, container);\n\nwindow.addEventListener(\"hashchange\", () => {\n    if (location.hash == \"#help\") game.restart();\n}); \n\nboardView.context.addEventListener(\"click\", function (event: MouseEvent) {\n    let x: number = Math.floor(event.offsetX / 5),\n        y: number = Math.floor(event.offsetY / 5),\n        grid = board.getGrid(x, y);\n\n    if (\n        MessageBox.isShow ||\n        game.nowPlayer.symbol !== \"O\" ||\n        stepHint[game.turn] &&\n        stepHint[game.turn].indexOf(grid) < 0\n    ) return;\n\n    if (game.selectGrid) game.selectGrid(grid);\n});\n\ngame.onstart = () => {\n    MessageBox.show(\"verify\", \"放置符號時需發生連線，無法繼續放置符號時便輸了，以下為連線的範例\", null);\n    game.selectedGrid = stepGrid[game.turn];\n    boardView.remove();\n};\n\ngame.onend = gameResult => {\n    let messageIcon = \"\";\n    let messageContent = \"\";\n\n    switch (gameResult) {\n        case 1:\n            messageIcon = \"owin\";\n            messageContent = \"圈方獲勝！\";\n            break;\n        case 2:\n            messageIcon = \"xwin\";\n            messageContent = \"叉方獲勝！\";\n            break;\n        case 3:\n            messageIcon = \"draw\";\n            messageContent = \"無人獲勝！\";\n            break;\n    }\n\n    MessageBox.show(`${messageIcon} accept reject`, messageContent, message => {\n        if (message == \"accept\") game.restart();\n    });\n};\n\nlet prevPlayerSymbol: RelatiSymbol = \"\";\n\ngame.onturnstart = () => {\n    prevPlayerSymbol = game.nowPlayer.symbol;\n\n    if (stepMessage[game.turn]) {\n        helpMessaageView.innerHTML = stepMessage[game.turn];\n    }\n};\n\ngame.ongridselect = boardView.update.bind(boardView);\n\ngame.onturnend = () => {\n    boardView.update();\n\n    let symbol = game.nowPlayer.symbol;\n    let grids = PlacementRule.trace(\n        game, symbol, BY_COMMON_RELATI\n    );\n\n    removeSVGChild(boardView.layers[0]);\n    removeSVGChild(boardView.layers[1]);\n\n    createHintEffect(\n        grids,\n        game.nowPlayer.symbol,\n        boardView.layers[1]\n    );\n\n    if (stepHint[game.turn]) {\n        for (let childNode of boardView.layers[1].childNodes as unknown as Array<ChildNode>) {\n            updateSVG(childNode as SVGElement, { \"opacity\": \"0.4\" });\n        }\n\n        createHintEffect(\n            stepHint[game.turn],\n            game.nowPlayer.symbol,\n            boardView.layers[1]\n        );\n    }\n\n    createRelatiEffect(prevPlayerSymbol, boardView.layers[0], game);\n\n    if (game.turn < 2) {\n        game.selectedGrid = stepGrid[game.turn];\n    } else setTimeout(() => {\n        if (game.selectGrid) game.selectGrid(stepGrid[game.turn]);\n    }, 2500);\n\n    switch (game.turn) {\n        case 11:\n            MessageBox.show(\"verify\", \"倘若將一處圍成區塊時，對方將無法藉由連線把符號放入其中\", null);\n            break;\n        case 51:\n            MessageBox.show(\"verify\", \"恭喜，想必你對遊戲有一些概念了\", function () {\n                Page.switchTo(\"main\");\n            });\n    }\n};\n\nlet stepGrid: { [turn: number]: RelatiGrid } = {\n    0: board.getGrid(4, 4),\n    1: board.getGrid(5, 4),\n    3: board.getGrid(4, 5),\n    5: board.getGrid(2, 4),\n    7: board.getGrid(5, 3),\n    9: board.getGrid(7, 1),\n    11: board.getGrid(7, 5),\n    13: board.getGrid(8, 5),\n    15: board.getGrid(5, 5),\n    17: board.getGrid(3, 5),\n    19: board.getGrid(2, 5),\n    21: board.getGrid(6, 4),\n    23: board.getGrid(5, 6),\n    25: board.getGrid(5, 7),\n    27: board.getGrid(4, 7),\n    29: board.getGrid(3, 7),\n    31: board.getGrid(2, 7),\n    33: board.getGrid(1, 7),\n    35: board.getGrid(0, 7),\n    37: board.getGrid(1, 5),\n    39: board.getGrid(1, 6),\n    41: board.getGrid(2, 2),\n    43: board.getGrid(3, 2),\n    45: board.getGrid(0, 3),\n    47: board.getGrid(4, 1),\n    49: board.getGrid(0, 2)\n};\n\nlet stepHint: { [turn: number]: RelatiGrid[] } = {\n    2: [board.getGrid(4, 3), board.getGrid(3, 3)],\n    4: [board.getGrid(2, 1), board.getGrid(3, 1)],\n    6: [board.getGrid(6, 3)],\n    8: [board.getGrid(5, 2)],\n    10: [board.getGrid(6, 2)],\n    12: [\n        board.getGrid(5, 0),\n        board.getGrid(5, 1),\n        board.getGrid(7, 3),\n        board.getGrid(8, 3)\n    ],\n    20: [board.getGrid(6, 5)],\n    22: [board.getGrid(7, 4)],\n    24: [board.getGrid(6, 7)],\n    26: [board.getGrid(5, 8)],\n    28: [board.getGrid(4, 8)],\n    30: [board.getGrid(3, 8)],\n    32: [board.getGrid(2, 8)],\n    34: [board.getGrid(1, 8)],\n    36: [board.getGrid(1, 3)],\n    38: [board.getGrid(0, 5)],\n    40: [board.getGrid(1, 1)],\n    42: [board.getGrid(2, 3)],\n    44: [board.getGrid(1, 2)],\n    46: [board.getGrid(2, 1), board.getGrid(3, 1)],\n    48: [board.getGrid(3, 0)],\n    50: [board.getGrid(0, 1)]\n};\n\nstepHint[14] = stepHint[12];\nstepHint[16] = stepHint[12];\nstepHint[18] = stepHint[12];\n\nlet stepMessage: { [turn: number]: string } = {\n    0: \"一般連線範例\",\n    3: \"遠程連線範例\",\n    5: \"遠程連線中斷範例\",\n    7: \"遠程連線恢復技巧\",\n    9: \"遠程連線中斷技巧\",\n    11: \"區塊建立技巧\",\n    19: \"區塊破壞技巧\",\n    27: \"區塊壓制技巧\",\n    41: \"區塊抗壓技巧\"\n};\n\nif (location.hash == \"#help\") game.restart();"],"sourceRoot":""}